<?php
	
	ini_set('max_execution_time','106540');
    include_once "fbmain.php";
    //abrindo conexao para gravação dos dados
    include_once 'config/conexao.inc';
    $conexao = new Conexao();
    $conexao->Open();
?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml">
    <head>    
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.js"></script>
        <title>Rede UnB Facebook</title>
    </head>
	<div id="fb-root"></div>
    <script type="text/javascript" src="http://connect.facebook.net/en_US/all.js"></script>
     <script type="text/javascript">
     //ajuste janela para firefox
   	    FB.init({
                appId  : '<?=$fbconfig['appid']?>',
                status : true, // check login status
                cookie : true, // enable cookies to allow the server to access the session
                xfbml  : true  // parse XFBML
              });

     </script>	
    <h3>Rede UnB Facebook</h3>

    <?php if (!$user) { 
        echo "Sua sessão está expirada."; 
    	echo "<a href='$loginUrl'>Facebook Login</a>";
     }
          if ($user){
    		try{
    			
    			/*array de páginas que só podem sere consultadas com permissão do usuário*/
    			$paginas_false = array("240380946010687"
    			,"112151588838279"
    			,"436144019735804"
    			,"352999187010"
    			,"280341402020655"
    			,"20828968298"
    			,"194185517280960"
    			,"123089997741853"
    			,"267484199979353"
    			,"144615618896812"
    			,"28340627616"
    			,"131368351403"
    			,"228349743895625"
    			,"115549928490709"
    			,"186196551431830"
    			,"255518161816"
    			,"160143947346013"
    			,"159593074130472"
    			,"178450068882739"
    			,"14148540817"
    			,"187826041269584"
    			,"80888608314"
    			,"94690604735"
    			,"8557191811"
    			,"366452641619"
    			,"398792920154345"
    			,"140786973315"
    			,"15480136831"
    			,"226009424080525"
    			,"118564288188019"
    			,"189126211132764"
    			,"123068796703"
    			,"222000051162203"
    			,"166649190058644"
    			,"157561708245"
    			,"120431517987666"
    			,"176893645692650"
    			,"194479917246693"
    			,"185275861493309"
    			,"198204776905884"
    			,"128843887159719"
    			,"6200594562"
    			,"216005798489161"
    			,"205813126692"
    			,"133105406723618"
    			,"203857959678638"
    			,"367896399897418"
    			,"179052362132632"
    			,"273506289364439"
    			,"93131771713"
    			,"160677734017558"
    			,"166365716743090"
    			,"364772323540706"
    			,"184710548208865"
    			,"424216534256804"
    			,"311238138948446"
    			,"11839445285"
    			,"210086575679964"
    			,"122669351092958"
    			,"426123747399694"
    			,"18523496658"
    			,"179500192118771"
    			,"118803861539088"
    			,"203780149682367"
    			,"158408204225594"
    			,"313376092024381"
    			,"111926505490017"
    			,"160195997327560"
    			,"133893883351736"
    			,"206581389396197"
    			,"242025305873062"
    			,"232770150094241"
    			,"209873552386158"
    			,"123702014399865"
    			,"147896188603785"
    			,"142521889141078"
    			,"119296274748870"
    			,"317240606190"
    			,"119762558360"
    			,"122306707871559"
    			,"197491523646172"
    			,"101623289890315"
    			,"115568635193981"
    			,"100811203362272"
    			,"171506096242554"
    			,"62248718804"
    			,"152044968189894"
    			,"184233964947882"
    			,"121884660207"
    			,"113805831968161"
    			,"232369013453065"
    			,"115448375151566"
    			,"156139071105791"
    			,"211118612243792"
    			,"207967232566940"
    			,"157523884303321"
    			,"191663480862515"
    			,"45350042677"
    			,"51752540096"
    			,"172068972837173"
    			,"202614756429662"
    			,"172638912749358"
    			,"96585522706"
    			,"272131952779"
    			,"218819944814697"
    			,"108940282480145"
    			,"66533446146"
    			,"140107506006878"
    			,"171475846226235"
    			,"124514550896644"
    			,"110714539970"
    			,"81288475752"
    			,"269407453131594"
    			,"91825719614"
    			,"259710397380641"
    			,"227383110655483"
    			,"119596931458261"
    			,"109294299094020"
    			,"158833687516744"
    			,"15525058505"
    			,"180475398686681"
    			,"332288446826940"
    			,"216465669362"
    			,"195289673862866"
    			,"141074696005420"
    			,"91800498227"
    			,"170161956364596"
    			,"199171603464793"
    			,"166242147663"
    			,"113143338706669"
    			,"184310434949538"
    			,"45312409115"
    			,"137533446325661"
    			,"363794713664999"
    			,"25714178886"
    			,"127735990588679"
    			,"321509631197661"
    			,"45780728787"
    			,"105854796103870"
    			,"156334964448192"
    			,"126875070662183"
    			,"93710908060"
    			,"181111741900279"
    			,"125765260785623"
    			,"300760038415"
    			,"110371575706285"
    			,"52880441687"
    			,"153466878036076"
    			,"116836871697323"
    			,"160771950648344"
    			,"116421971772237"
    			,"152069268196507"
    			,"8391697661"
    			,"257453204279241"
    			,"55982004572"
    			,"247169439803"
    			,"77852784853"
    			,"217348891624769"
    			,"114031848671746"
    			,"148145098594184"
    			,"159113470767507"
    			,"36432967448"
    			,"217560214981242"
    			,"231822626904914"
    			,"6119163067"
    			,"398140613535474"
    			,"124200947660478"
    			,"133925524350"
    			,"137963916316939"
    			,"150904358353357"
    			,"182296565178092"
    			,"224614054246170"
    			,"133825109031"
    			,"202239803130181"
    			,"7375776713"
    			,"137800392993166"
    			,"153420574694305"
    			,"112565262094306"
    			,"38995979792"
    			,"233869729971479"
    			,"206550296052269"
    			,"236955463012316"
    			,"15750759142"
    			,"382211618468705"
    			,"237012793031375"
    			,"237089312992745"
    			,"233872546630885"
    			,"169898603042462"
    			,"153449184748391"
    			,"164546396908077"
    			,"152931888153683"
    			,"14051860899"
    			,"230100670375742"
    			,"108951919190317"
    			,"120596594667213"
    			,"225627094173501"
    			,"250295948351144"
    			,"141876865915226"
    			,"282777095110039"
    			,"152304814815991"
    			,"164270236939880"
    			,"348204249467"
    			,"183317635046816"
    			,"108327462585807"
    			,"148252045192592"
    			,"158120304257589"
    			,"164821516918497"
    			,"212634978764975"
    			,"386697844678479"
    			,"159817980750183"
    			,"201021746574712"
    			,"191371800912927"
    			,"200012840039981"
    			,"116390278410291"
    			,"127239137329230"
    			,"421855687829228"
    			,"187688941270618"
    			,"244393845627309"
    			,"265445256884875"
    			,"98925339098"
    			,"134092296688348"
    			,"155805848520"
    			,"229094610455011"
    			,"148863165156955"
    			,"190187031021182"
    			,"362484583767747"
    			,"10150105867180052"
    			,"225563130836455"
    			,"191408264224251"
    			,"141285316700"
    			,"151846024866442"
    			,"123461907733914"
    			,"10371116567"
    			,"41872475652"
    			,"209816645711129"
    			,"100275586681484"
    			,"264560296934113"
    			,"229439427139734"
    			,"12214824722"
    			,"112318622121606"
    			,"275245305845137"
    			,"117266501638089"
    			,"137687509617924"
    			,"32394062867"
    			,"182352755148554"
    			,"125068350877842"
    			,"149242381776278"
    			,"171953606243698"
    			,"160667118659"
    			,"139640322784389"
    			,"146444515438871"
    			,"225687150777873"
    			,"43232606568"
    			,"417038868708"
    			,"214736588575395"
    			,"210679305618676"
    			,"237921872924270"
    			,"166613490126799"
    			,"144172232305658"
    			,"51982039079"
    			,"109452242408378"
    			,"20410752104"
    			,"116581771751822"
    			,"141637042534138"
    			,"109221232453104"
    			,"188072264556252"
    			,"78677647169"
    			,"203206869718110"
    			,"145520305469198"
    			,"56967160805"
    			,"47892487749"
    			,"134920296584626"
    			,"259708024051524"
    			,"168271139875397"
    			,"45821824556"
    			,"113896612032196"
    			,"162386440488222"
    			,"6845141683"
    			,"166698923359118"
    			,"196544243693140"
    			,"16720058205"
    			,"259487070770809"
    			,"121547577056"
    			,"156450171137588"
    			,"216307938400149"
    			,"352456291447084"
    			,"182309465166631"
    			,"106864959361230"
    			,"109338996641"
    			,"141035915940990"
    			,"246176352098732"
    			,"268873383130487"
    			,"292986507410735"
    			,"149315725799"
    			,"122295524541980"
    			,"246002808779107"
    			,"7947488730"
    			,"193742067337518"
    			,"310026673939"
    			,"33722671296"
    			,"167556899932275"
    			,"176871525732663"
    			,"193801173989136"
    			,"309813549051004"
    			,"255692541150616"
    			,"100588342046"
    			,"187034674659292"
    			,"176357165753600"
    			,"136188433069392"
    			,"174302205951963"
    			,"188826324497373"
    			,"232024560147324"
    			,"133428563355135"
    			,"191023970963072"
    			,"206621792716402"
    			,"144149402358810"
    			,"217876004909480"
    			,"56783113958"
    			,"109800605777477"
    			,"172014432851353"
    			,"111835052232194"
    			,"139410629426584"
    			,"127510390611984"
    			,"85811091644"
    			,"142230125804817"
    			,"172558062803098"
    			,"171754246222686"
    			,"289448057773146"
    			,"165279495198"
    			,"211783828860018"
    			,"308769765570"
    			,"118665145907"
    			,"120629454619758"
    			,"104525012958754"
    			,"9406235892"
    			,"286473521404202"
    			,"180148405386454"
    			,"355931974431525"
    			,"193246157382456"
    			,"116202919324"
    			,"95583130368"
    			,"115625068468377"
    			,"20320777672"
    			,"330321689174"
    			,"185727281480330"
    			,"226419994050153"
    			,"216535948375873"
    			,"296820793672330"
    			,"127702163957422"
    			,"37970559976"
    			,"231403183620506"
    			,"131476150290450"
    			,"62688139887"
    			,"249555171803461"
    			,"305393532826061"
    			,"243279855691828"
    			,"105868097300"
    			,"69004099657"
    			,"88276686377"
    			,"303678172591"
    			,"171098623000393"
    			,"14345547933"
    			,"280034132055819"
    			,"117102765046115"
    			,"148331841845637"
    			,"103018149781579"
    			,"130272620433559"
    			,"124756567564490"
    			,"104558368551"
    			,"372337676116881"
    			,"159239150785766"
    			,"278519471700"
    			,"168752359848969"
    			,"336634983045478"
    			,"182637145121673"
    			,"177330152306241"
    			,"49233283777"
    			,"113527085344189"
    			,"276038162426248"
    			,"119423834739563"
    			,"7144906559"
    			,"100143173384387"
    			,"200970563277254"
    			,"103690329734480"
    			,"187201887980617"
    			,"290098664339426"
    			,"185082684870948"
    			,"263465237005359"
    			,"141985452530533"
    			,"202986116383406"
    			,"251354918238738"
    			,"174115995957737"
    			,"146759248704631"
    			,"345883181357"
    			,"172492047362"
    			,"237331099689942"
    			,"207338322618807"
    			,"302862436409890"
    			,"195462716995"
    			,"123071274371427"
    			,"128520727237282"
    			,"190189074354057"
    			,"109336685751749"
    			,"383539888341584"
    			,"146011422129314"
    			,"219939351368930"
    			,"186642901362979"
    			,"155809821140805"
    			,"132599876760254"
    			,"190700230997644"
    			,"336462858011"
    			,"12610075708"
    			,"148276868563805"
    			,"204931799521552"
    			,"142826622422975"
    			,"225313367479520"
    			,"142951609048900"
    			,"165538563488372"
    			,"182291438629"
    			,"209848599088791"
    			,"116435835078574"
    			,"108200322598342"
    			,"232646180083432"
    			,"177646362280403"
    			,"104284712059"
    			,"118685538221112"
    			,"168319969927304"
    			,"271196797075"
    			,"111719408908765"
    			,"213863542042392"
    			,"178012455566324"
    			,"58398254703"
    			,"183588965058985"
    			,"246101298803254"
    			,"228633390536306"
    			,"40697085414"
    			,"210443622314163"
    			,"234944899883833"
    			,"250887454944521"
    			,"198439296895410"
    			,"29215062379"
    			,"85964110668"
    			,"11006847845"
    			,"487013385450"
    			,"151479604912435"
    			,"45204739788"
    			,"177530692347202"
    			,"277561748952892"
    			,"209373612426002"
    			,"304046239617295"
    			,"335023844056"
    			,"194528960616163"
    			,"174612785965305"
    			,"141627992572943"
    			,"189766991040096"
    			,"169930420685"
    			,"177822619674"
    			,"178173442228802"
    			,"165817336869456"
    			,"195954330447496"
    			,"119312901430210"
    			,"105210599566746"
    			,"49180439288"
    			,"105664929473188"
    			,"196182837117280"
    			,"154656127960315"
    			,"165403476857385"
    			,"143507682412688"
    			,"24286307906"
    			,"232948993387746"
    			,"308775617671"
    			,"39802966364"
    			,"180141942083068"
    			,"143265615742961"
    			,"117798278234580"
    			,"6793147305"
    			,"322151497840720"
    			,"145372195529527"
    			,"108344955925190"
    			,"330003697569"
    			,"173794999318833"
    			,"114498345258149"
    			,"132324754807"
    			,"193019677408447"
    			,"119284572028"
    			,"131263450224596"
    			,"104832166228947"
    			,"287378891157"
    			,"118587474894064"
    			,"226019470763082"
    			,"138327506222332"
    			,"199795366706389"
    			,"150061411756748"
    			,"131964806866371"
    			,"176018112459393"
    			,"184803508221764"
    			,"63079656228"
    			,"244348752314807"
    			,"72118553599"
    			,"167510866631665"
    			,"372958517676"
    			,"248139171883907"
    			,"281999841814437"
    			,"171765816227157"
    			,"203072973094567"
    			,"179973252534"
    			,"138517696187965"
    			,"7174672354"
    			,"148552101822212"
    			,"110275945673096"
    			,"153363658098893"
    			,"6047942982"
    			,"165424553483887"
    			,"202287269813919"
    			,"131740833572610"
    			,"177623228986888"
    			,"132584057957"
    			,"102757879785427"
    			,"6280019085"
    			,"206013049429643"
    			,"43341861055"
    			,"126327242315"
    			,"12604171859"
    			,"102106906525939"
    			,"92632332061"
    			,"109569029915"
    			,"232209060122760"
    			,"273216799393116"
    			,"127206164008383"
    			,"137272183005088"
    			,"194846137225728"
    			,"109507585793907"
    			,"279042764459"
    			,"117812911675781"
    			,"246664875423642"
    			,"151650761609513"
    			,"124149547653114"
    			,"236637953019696"
    			,"159485487397496"
    			,"111248595561414"
    			,"199021820111440"
    			,"292957957398322"
    			,"98862235493"
    			,"107407509362912"
    			,"148357969895"
    			,"168095209884964"
    			,"114205395630"
    			,"250191655032099"
    			,"124384784245704"
    			,"152608961467281"
    			,"194028343952388"
    			,"401800163184839"
    			,"147996441940506"
    			,"122846004398897"
    			,"340054369345831"
    			,"148842921107"
    			,"191503210900457"
    			,"176070819079167"
    			,"229787457059368"
    			,"302777016417038"
    			,"129195837150863"
    			,"240462150592"
    			,"131351530257342"
    			,"94289470471"
    			,"341583949221299"
    			,"153547874260"
    			,"206391839426935"
    			,"105389049564845"
    			,"196769603695939"
    			,"92989572403"
    			,"131420130276176"
    			,"57133737851"
    			,"270675920106"
    			,"218735611473185"
    			,"100934416706873"
    			,"247750871907043"
    			,"176952725707679"
    			,"118708651478319"
    			,"165232073565378"
    			,"161292540615550"
    			,"189612767755294"
    			,"10561082161"
    			,"119622118068544"
    			,"125660600846414"
    			,"196652875296"
    			,"142551529113337"
    			,"108878689147948"
    			,"114852485545"
    			,"280407555326832"
    			,"159872253062"
    			,"28812359573"
    			,"221638434574396"
    			,"100119952246"
    			,"166569436686716"
    			,"260646610658774"
    			,"29214575987"
    			,"152577928107658"
    			,"115023098522042"
    			,"240121259344431"
    			,"184063110799"
    			,"170553269654568"
    			,"158667724184410"
    			,"263870783641395"
    			,"286861344662855"
    			,"205266419527084"
    			,"212546301666"
    			,"215777288475670"
    			,"137784319576409"
    			,"118063323645"
    			,"233420016713768"
    			,"127548060691781"
    			,"140834155944577"
    			,"198412063502742"
    			,"20584289802"
    			,"155525797824691"
    			,"135677909849752"
    			,"148018205268816"
    			,"58660150958"
    			,"112972802060226"
    			,"347742876973"
    			,"158964320779"
    			,"114142085305957"
    			,"254732244538612"
    			,"114745081884504"
    			,"112558548770467"
    			,"183291132940"
    			,"10150116088280068"
    			,"171011652900"
    			,"6020654822"
    			,"185243568170788"
    			,"109214195784751"
    			,"60649471874"
    			,"121700877904985"
    			,"321422338684"
    			,"260208707398"
    			,"78436661801"
    			,"125437087560323"
    			,"252443374826473"
    			,"298061143548416"
    			,"110890985613262"
    			,"174868769259342"
    			,"127430880653214"
    			,"200028416700823"
    			,"148444865199609"
    			,"131482610237923"
    			,"194480880590713"
    			,"133340686735389"
    			,"140191166021248"
    			,"112170395470694"
    			,"92284851236"
    			,"229899403738458"
    			,"157252397676581"
    			,"136410662640"
    			,"174208293206"
    			,"275763281196"
    			,"224577374235142"
    			,"132656813424"
    			,"107457655941795"
    			,"216390115049018"
    			,"335096549859803"
    			,"170210243087231"
    			,"114664035283389"
    			,"116676921739861"
    			,"187142608061850"
    			,"345594215477497"
    			,"258125530868895"
    			,"110617405652420"
    			,"218026168266335"
    			,"115907555104573"
    			,"117983638238613"
    			,"275335412486167"
    			,"173433689340252"
    			,"109848080659"
    			,"216083718459093"
    			,"199682323392012"
    			,"92634114453"
    			,"241068972583404"
    			,"106299705436"
    			,"136347406469972"
    			,"216299650110"
    			,"56727800941"
    			,"89041380369"
    			,"122303941213665"
    			,"111009124244"
    			,"134203750019055"
    			,"119249058108675"
    			,"155198931231217"
    			,"199148053460966"
    			,"74509253322"
    			,"334100421797"
    			,"117482488335466"
    			,"208927312510215"
    			,"244835685539737"
    			,"136588786389818"
    			,"13691980085"
    			,"218355508178586"
    			,"18312374503"
    			,"187945421221485"
    			,"238821149548398"
    			,"9659019330"
    			,"192781535666"
    			,"291412270300"
    			,"91459414961"
    			,"427150990646419"
    			,"166322256756653"
    			,"116259801790661"
    			,"154817794604022"
    			,"202208836468341"
    			,"121329877991992"
    			,"164787110276847"
    			,"327435893980301"
    			,"123914954295766"
    			,"215796831814294"
    			,"265883986792575"
    			,"228263283908846"
    			,"199346206774296"
    			,"110712698957584"
    			,"202998336423778"
    			,"163477603665469"
    			,"105314939517871"
    			,"221153874567048"
    			,"109918909035681"
    			,"252463804771071"
    			,"119198254829227"
    			,"155222184544496"
    			,"56077794946"
    			,"68066661384"
    			,"159470687455052"
    			,"309359619494"
    			,"367183537165"
    			,"22981282256"
    			,"231503120240251"
    			,"144962222270546"
    			,"210706375645672"
    			,"205181706243336"
    			,"92320479952"
    			,"389176320224"
    			,"216390138373069"
    			,"102141823208501"
    			,"214836715271914"
    			,"136727569686142"
    			,"150525838888"
    			,"135747814053"
    			,"175085370557"
    			,"282289531829611"
    			,"105797592866793"
    			,"163253360360240"
    			,"120685448012735"
    			,"83969398808"
    			,"54760291353"
    			,"114026835343928"
    			,"274447540060"
    			,"248627738490584"
    			,"118843458195668"
    			,"56833114165"
    			,"300964261513"
    			,"136467366420998"
    			,"113299055347877"
    			,"135907179811097"
    			,"190344604312022"
    			,"101255546603758"
    			,"150607108341241"
    			,"74089565764"
    			,"187749077971022"
    			,"204038236306139"
    			,"173371919382619"
    			,"109480629101278"
    			,"177421512311802"
    			,"186028571601"
    			,"120203428059048"
    			,"317272608285683"
    			,"196271733740780"
    			,"181143068648999"
    			,"130487163743220");
    			
    			//
    			for($i = 718; $i < sizeof($paginas_false); $i++)
    			{
    			$fql_amigos = "SELECT page_id, name, pic, fan_count, type, description, talking_about_count FROM page WHERE page_id = $paginas_false[$i]";
    			
    			$param  =   array(
    					'method'    => 'fql.query',
    					'query'     => $fql_amigos,
    					'callback'  => ''
    			);
    			
    			//fan_count = likes
    			//id = page_id
    			//picture = pic (escolhido pra ser)
    			
    			$fanpageids_rows = $facebook->api($param);
    			$pageid_fanpage = $fanpageids_rows[0]['page_id'];
    			$name_fanpage = $fanpageids_rows[0]['name'];
    			$picture = $fanpageids_rows[0]['pic'];
    			$likes = @$fanpageids_rows[0]['fan_count'];
    			$category = $fanpageids_rows[0]['type'];
    			$description = @$fanpageids_rows[0]['description'];
    			$talking_about_count = @$fanpageids_rows[0]['talking_about_count'];
    			//inserindo no banco de dados
    			$query_fanpage = "INSERT INTO fanpage (pageid_fanpage, name_fanpage, picture, likes, category, description, talking_about_count) VALUES ($1, $2, $3, $4, $5, $6, $7)";
    			pg_prepare($conexao->con(), "", $query_fanpage);
    			pg_execute($conexao->con(), "", array($pageid_fanpage, $name_fanpage, $picture, $likes, $category, $description, $talking_about_count ));
    		}
    			
          	}catch(Exception $o){
		    			print_r($o);
	    			}
          }
    			
    			
     	?>       
</html>